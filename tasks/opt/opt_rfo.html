<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RFO Optimization - MAPLE</title>
  <link rel="stylesheet" href="../../assets/css/styles.css">
</head>
<body>
  <header class="top-nav">
    <div class="container">
      <div class="brand">
        <a href="../../index.html"><img src="../../assets/images/logo.jpg" alt="MAPLE Logo"></a>
        <a href="../../index.html">MAPLE</a>
      </div>
      <button class="mobile-toggle" aria-label="Toggle menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      </button>
      <nav>
        <ul>
          <li><a href="../../index.html">Home</a></li>
          <li><a href="../../general.html">About</a></li>
          <li><a href="../../documentation.html">Documentation</a></li>
          <li><a href="../../articles.html">Articles</a></li>
          <li><a href="../../downloads.html">Downloads</a></li>
          <li><a href="../../development.html">Development</a></li>
          <li><a href="../../issues.html">Report Issue</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="page-layout">
    <aside class="sidebar">
      <nav class="sidebar-nav">
        <div class="sidebar-brand">
          <img src="../../assets/images/logo.jpg" alt="MAPLE">
          <span>MAPLE Docs</span>
        </div>
        <div class="sidebar-tree">
          <ul>
            <li>
              <span class="tree-section"><span class="chevron"></span> Getting Started</span>
              <ul class="children">
                <li><a href="../../tutorials/installation.html">Installation</a></li>
                <li><a href="../../tutorials/quickstart.html">Quick Start</a></li>
                <li><a href="../../tutorials/input_output.html">Input &amp; Output</a></li>
              </ul>
            </li>
            <li>
              <span class="tree-section"><span class="chevron"></span> Input Setup</span>
              <ul class="children">
                <li><a href="../../setup/settings.html">Settings</a></li>
                <li><a href="../../setup/coordinates.html">Coordinates</a></li>
                <li><a href="../../setup/models.html">ML Models</a></li>
              </ul>
            </li>
            <li class="open">
              <span class="tree-section"><span class="chevron"></span> Tasks</span>
              <ul class="children">
                <li><a href="../../tasks/singlepoint.html">Single Point</a></li>
                <li><a href="../../tasks/frequency.html">Frequency</a></li>
                <li class="open">
                  <span class="tree-label"><span class="chevron"></span> <a href="optimization.html">Optimization</a></span>
                  <ul class="children">
                    <li><a href="opt_lbfgs.html">L-BFGS</a></li>
                    <li><a href="opt_rfo.html" class="active">RFO</a></li>
                    <li><a href="opt_sd.html">SD</a></li>
                  </ul>
                </li>
                <li>
                  <span class="tree-label"><span class="chevron"></span> <a href="../ts/ts.html">Transition State</a></span>
                  <ul class="children">
                    <li><a href="../ts/ts_prfo.html">P-RFO</a></li>
                    <li><a href="../ts/ts_neb.html">NEB</a></li>
                    <li><a href="../ts/ts_dimmer.html">Dimer</a></li>
                    <li><a href="../ts/ts_string.html">String/GSM</a></li>
                    <li><a href="../ts/ts_autoneb.html">AutoNEB</a></li>
                  </ul>
                </li>
                <li>
                  <span class="tree-label"><span class="chevron"></span> <a href="../scan/scan.html">PES Scan</a></span>
                  <ul class="children">
                    <li><a href="../scan/scan_lbfgs.html">L-BFGS</a></li>
                    <li><a href="../scan/scan_rfo.html">RFO</a></li>
                  </ul>
                </li>
                <li>
                  <span class="tree-label"><span class="chevron"></span> <a href="../irc/irc.html">IRC</a></span>
                  <ul class="children">
                    <li><a href="../irc/irc_gs.html">GS</a></li>
                    <li><a href="../irc/irc_lqa.html">LQA</a></li>
                    <li><a href="../irc/irc_hpc.html">HPC</a></li>
                    <li><a href="../irc/irc_eulerpc.html">EulerPC</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>
              <span class="tree-section"><span class="chevron"></span> Functions</span>
              <ul class="children">
                <li><a href="../../functions/solvent.html">Solvation</a></li>
                <li><a href="../../functions/constrain.html">Constraints</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </nav>
    </aside>

    <main class="content">
      <article>
        <nav class="breadcrumb" aria-label="Breadcrumb">
          <a href="../../index.html">Home</a>
          <span class="separator">/</span>
          <a href="../../documentation.html">Docs</a>
          <span class="separator">/</span>
          <a href="../../documentation.html">Tasks</a>
          <span class="separator">/</span>
          <a href="optimization.html">Optimization</a>
          <span class="separator">/</span>
          <span class="current">RFO</span>
        </nav>

        <h1>RFO Optimization</h1>

        <h2 id="overview">Overview</h2>
        <p>RFO (Rational Function Optimization) is a second-order optimization method that uses a trust-radius strategy to control step sizes. Rather than relying solely on the gradient direction, RFO constructs a rational function model of the potential energy surface and determines the optimal step within a dynamically adjusted trust region.</p>
        <p>At each iteration, the algorithm compares the predicted energy change from its model with the actual energy change. If the model prediction is accurate, the trust radius is expanded to allow larger steps. If the prediction is poor, the step is rejected and the trust radius is contracted. This adaptive behavior makes RFO more robust than L-BFGS for systems with strong curvature or difficult potential energy surfaces.</p>

        <h2 id="parameters">Parameters</h2>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Default</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>max_iter</code></td>
                <td>int</td>
                <td><code>256</code></td>
                <td>Maximum number of optimization cycles.</td>
              </tr>
              <tr>
                <td><code>trust_radius_init</code></td>
                <td>float</td>
                <td><code>0.2</code></td>
                <td>Initial trust radius in Angstrom.</td>
              </tr>
              <tr>
                <td><code>trust_radius_min</code></td>
                <td>float</td>
                <td><code>1e-3</code></td>
                <td>Minimum trust radius.</td>
              </tr>
              <tr>
                <td><code>trust_radius_max</code></td>
                <td>float</td>
                <td><code>1.0</code></td>
                <td>Maximum trust radius.</td>
              </tr>
              <tr>
                <td><code>eta_shrink</code></td>
                <td>float</td>
                <td><code>0.75</code></td>
                <td>Trust radius shrink factor when step quality is poor.</td>
              </tr>
              <tr>
                <td><code>eta_expand</code></td>
                <td>float</td>
                <td><code>1.75</code></td>
                <td>Trust radius expansion factor when step quality is good.</td>
              </tr>
              <tr>
                <td><code>evals_eps</code></td>
                <td>float</td>
                <td><code>1e-10</code></td>
                <td>Eigenvalue epsilon for numerical stability.</td>
              </tr>
              <tr>
                <td><code>mu_margin</code></td>
                <td>float</td>
                <td><code>1e-8</code></td>
                <td>Margin for the level-shift parameter mu.</td>
              </tr>
              <tr>
                <td><code>max_bisect_it</code></td>
                <td>int</td>
                <td><code>60</code></td>
                <td>Maximum bisection iterations for level-shift optimization.</td>
              </tr>
              <tr>
                <td><code>write_traj</code></td>
                <td>bool</td>
                <td><code>True</code></td>
                <td>Write intermediate geometries to a trajectory file.</td>
              </tr>
              <tr>
                <td><code>traj_every</code></td>
                <td>int</td>
                <td><code>1</code></td>
                <td>Write trajectory frame every N optimization steps.</td>
              </tr>
            </tbody>
          </table>
        </div>

        <h2 id="input-example">Input Example</h2>
        <p>A minimal input file using RFO optimization:</p>
        <pre><code>#model=uma
#opt(method=rfo)
#device=gpu0

O    0.000000    0.000000    0.117300
H    0.000000    0.757200   -0.469200
H    0.000000   -0.757200   -0.469200</code></pre>

        <h2 id="when-to-use-rfo">When to Use RFO</h2>
        <p>RFO is a good alternative when L-BFGS struggles to converge. Consider switching to RFO in the following situations:</p>
        <ul>
          <li><strong>Systems near a minimum with strong curvature:</strong> RFO uses full Hessian information (built up over iterations) and a trust-radius mechanism, which handles regions of high curvature more reliably than the limited-memory approximation in L-BFGS.</li>
          <li><strong>Difficult or sensitive potential energy surfaces:</strong> When L-BFGS oscillates or fails to reduce the energy monotonically, the trust-radius step acceptance/rejection logic in RFO provides a built-in safeguard against bad steps.</li>
          <li><strong>Small to medium-sized molecules:</strong> RFO stores and manipulates the full Hessian matrix, so its memory and computational cost scale quadratically with system size. For very large systems (thousands of atoms), L-BFGS is generally more efficient.</li>
          <li><strong>Pre-optimization before frequency calculations:</strong> When a tight convergence is needed, RFO can be more reliable for the final stages of optimization because its trust-radius approach adapts naturally to the curvature near the minimum.</li>
        </ul>

        <div class="admonition tip">
          <div class="admonition-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
            Tip
          </div>
          <div class="admonition-body">
            <p>For large systems where RFO is too expensive, try L-BFGS with a reduced <code>max_step</code> as a compromise between robustness and efficiency.</p>
          </div>
        </div>

        <nav class="page-nav">
          <a href="opt_lbfgs.html">&larr; L-BFGS</a>
          <a class="next" href="opt_sd.html">SD &rarr;</a>
        </nav>
      </article>
    </main>

    <aside class="toc">
      <div class="toc-sticky">
        <h3>On this page</h3>
        <ul></ul>
      </div>
    </aside>
  </div>
  <div class="sidebar-overlay"></div>
  <footer><p>&copy; 2026, MAPLE development team.</p></footer>
  <script src="../../assets/js/main.js"></script>
</body>
</html>
